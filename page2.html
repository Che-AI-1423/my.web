<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KOL 表格示範</title>
  <style>
    body { font-family: -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px 10px; text-align: left; }
    th { background: #f5f7fb; }
    caption { text-align:left; margin-bottom:8px; color:#666; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Supabase 表格最小版</h1>
  <p id="msg">讀取中…</p>
  <table id="tbl" style="display:none;">
    <caption>來源：public.kol_ig_db（前 20 筆）</caption>
    <thead>
      <tr><th>#</th><th>名稱</th><th>粉絲數</th><th>互動率</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // ← 換成你的專案
    const SUPABASE_URL  = "https://brszmjgodlmhsqkbcvmd.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJyc3ptamdvZGxtaHNxa2Jjdm1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMjQ5NDAsImV4cCI6MjA2OTkwMDk0MH0.aIU16WE7MZdbJtPOb5qbPpizaufXaOtTnjgxcTqE-ik";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    const toPct = (v) => (v == null ? null : (v <= 1 ? v * 100 : v));

    (async () => {
      const msg = document.getElementById('msg');
      const tbl = document.getElementById('tbl');
      const tbody = tbl.querySelector('tbody');

      // 拉 20 筆資料（無篩選）
      const { data, error } = await supabase
        .from('kol_ig_db')
        .select('ig_name, ig_followers, emg_rate')
        .order('ig_followers', { ascending: false })
        .limit(20);

      if (error) {
        msg.textContent = '查詢錯誤：' + error.message;
        return;
      }
      if (!data || data.length === 0) {
        msg.textContent = '查無資料（多半是 RLS policy 未放行或表名不符）';
        return;
      }

      // 渲染表格
      tbody.innerHTML = data.map((r, i) => {
        const er = toPct(r.emg_rate);
        const erTxt = er == null ? '—' : (Math.round(er*100)/100)+'%';
        const fans = r.ig_followers?.toLocaleString?.() ?? '未知';
        return `<tr><td>${i+1}</td><td>${r.ig_name ?? '（未命名）'}</td><td>${fans}</td><td>${erTxt}</td></tr>`;
      }).join('');

      msg.textContent = '';
      tbl.style.display = '';
    })();
  </script>
</body>
</html>
